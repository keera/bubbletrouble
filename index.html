<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
    <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/normalize.min.css">
        <link rel="stylesheet" href="css/main.css">
        <style type="text/css">
            canvas {
                border: 1px solid #000;
            }
        </style>
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <p>
            Hello world! This is HTML5 Boilerplate.
        </p>
        <canvas id="tutorial" width="150" height="150"></canvas>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.1.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
        <script>
          //close path
          //http://stackoverflow.com/questions/10807230/what-exactly-is-a-canvas-path-and-what-is-the-use-of-ctx-closepath
          var canvas = document.getElementById('tutorial');
          var ctx = null;
          var x = canvas.width / 2;
          var y = canvas.height / 2;
          var radius = 10;
          var ball = null;
          var person = null;
          var spear = null;
          var animateSpear = false;

          function init() {
            if(canvas.getContext) {
              ctx = canvas.getContext('2d');
              var time = (new Date()).getTime();
              var myDot = {
                x : 75,
                y : 150,
              };
              ball = new Ball(x, y, radius, ctx);
              person = new Person(0, 140, ctx);
              person.weapon = new person.weapon(ctx, myDot, time);
            }
            return setInterval(draw, 10);
          }

          function Spear(ctx, myDot, startTime) {
            this.ctx = ctx;
            this.startTime = startTime;
            this.myDot = myDot;
            this.history = {
              x : [],
              y : []
            };
          }


          Spear.prototype.drawDot = function(myDot, context) {
            for(var i = 0; i < this.history.x.length; i++) {
              context.fillRect(this.history.x[i], this.history.y[i], 1, 1);
            }
          }

          Spear.prototype.clearSpear = function(context) {
            for(var i = 0; i < this.history.x.length; i++) {
              context.clearRect(this.history.x[i], this.history.y[i], 1, 1);
            }
          }

          Spear.prototype.drawLine = function() {
            this.ctx.beginPath();
            this.ctx.moveTo(this.history.x[0], this.history.y[0]);
            this.ctx.lineTo(this.history.x[0], 0);
            this.ctx.stroke();
          }

          Spear.prototype.animate = function() {
            // update
            if(this.history.x.length == 0){
                this.myDot.x = person.x;
                this.myDot.y = person.y;
            }
            this.history.x.push(this.myDot.x);
            this.history.y.push(this.myDot.y);
            var time = (new Date()).getTime() - this.startTime;
            var amplitude = 5;
            // in ms
            var period = 200;
            var centerX = this.history.x[0];
            var nextX = amplitude * Math.sin(time * 2 * Math.PI / period) + centerX;
            this.myDot.x = nextX;
            this.myDot.y--;

            //Check if it hit the top. If so, clear it.
            if(this.myDot.y <= 0) {
              console.log("Clearing");
              this.clearSpear(this.ctx);
              this.drawLine();
              return;
            }

            this.drawDot(this.myDot, this.ctx);
          }
          
          function Person(x, y, ctx) {
            this.x = x;
            this.dx = 10;
            this.dy = 10;
            this.y = y;
            this.ctx = ctx;
          }
          
          //give this person the spear
          Person.prototype.weapon = Spear;

          Person.prototype.draw = function() {
            this.ctx.beginPath();
            this.ctx.fillStyle = "black";
            this.ctx.rect(this.x, this.y, 10, 10);
            this.ctx.closePath();
            this.ctx.fill();
          }

          Person.prototype.moveLeft = function() {
            this.x -= this.dx;
          }

          Person.prototype.moveRight = function() {
            this.x += this.dx;
          }
          function Ball(x, y, radius, ctx) {
            this.x = x;
            // x location
            this.y = y;
            // location
            this.dx = 1;
            // x velocity
            this.dy = 0;
            // y velocity
            this.gravity = 0.2;
            this.xdirection = 1;
            // Direction y
            this.ydirection = 1;
            this.radius = radius;
            this.ctx = ctx;
            this.count = 0;
          }


          Ball.prototype.draw = function() {
            //this.ctx.fillStyle = "rgba(255,0,255,0)";
            this.ctx.beginPath();
            this.fillStyle = "black";
            this.ctx.arc(this.x, this.y, radius, 0, 2 * Math.PI, true);
            this.ctx.closePath();
            this.ctx.fill();
          }

          Ball.prototype.move = function() {
            this.hasCollided();
            this.dy += this.gravity;
            this.x += this.dx * this.xdirection;
            this.y += this.dy * this.ydirection;
          }

          Ball.prototype.hasCollided = function() {
            // Previous distance increase pushed it over limit
            if(this.y + this.radius > 150) {
              this.ydirection = -this.ydirection;
              this.dy += this.gravity;
              // Add increase again so next call
              // gets reduced by same amt (symmetry)
              // ie: 1, 2, 3, 3, 2, 1
              this.gravity = -this.gravity;
              //reverse gravity
            }

            if(this.x + this.radius > 150 || this.x + this.radius < 0) {
              this.xdirection = -this.xdirection;
            }
          }
          function clear() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
          }

          function draw() {
            clear();
            ball.draw();
            person.draw();
            ball.move();
            if(animateSpear)
               person.weapon.animate();
          }

          //llisteners

          $(document).keypress(function(event) {
            if(event.charCode == 97) {
              person.moveLeft();
            }
            if(event.charCode == 100) {
              person.moveRight();
            }
            if(event.charCode == 32) {
              animateSpear = true;
            }
          });
          init();

        </script>
        <script>
          var _gaq = [['_setAccount', 'UA-XXXXX-X'], ['_trackPageview']]; ( function(d, t) {
            var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
            g.src = '//www.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g, s)
          }(document, 'script'));

        </script>
    </body>
</html>
